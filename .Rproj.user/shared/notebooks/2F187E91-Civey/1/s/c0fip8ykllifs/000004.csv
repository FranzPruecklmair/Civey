"0","#schleife"
"0","set.seed(090421)"
"0",""
"0","r <- 1"
"0","c <- 2500"
"0","internet.cor <- matrix(0,nrow = r,ncol=6)"
"0","blogger.cor <- matrix(0,nrow = r,ncol=6)"
"0","interpol.cor <- matrix(0,nrow = r,ncol=6)"
"0",""
"0","internet.rak <- matrix(0,nrow = r,ncol=6)"
"0","blogger.rak <- matrix(0,nrow = r,ncol=6)"
"0","interpol.rak <- matrix(0,nrow = r,ncol=6)"
"0",""
"0","pseudoweights_blogger <- matrix(0,nrow = r,ncol = c)"
"0","pseudoweights_internet <- matrix(0,nrow = r,ncol = c)"
"0","pseudoweights_interpol <- matrix(0,nrow = r,ncol = c)"
"0",""
"0","calibrationweights_blogger <- matrix(0,nrow = r,ncol = c)"
"0","calibrationweights_internet <- matrix(0,nrow = r,ncol = c)"
"0","calibrationweights_interpol <- matrix(0,nrow = r,ncol = c)"
"0",""
"0","meaninternet.cor <- rep(0,length(length(psp)))"
"0","meanblogger.cor <- rep(0,length(length(psp)))"
"0","meaninterpol.cor <- rep(0,length(length(psp)))"
"0",""
"0",""
"0","meaninternet.rak<- rep(0,length(length(psp)))"
"0","meanblogger.rak<- rep(0,length(length(psp)))"
"0","meaninterpol.rak<- rep(0,length(length(psp)))"
"0",""
"0",""
"0",""
"0","abs.bias.internet.cor <- rep(0,length(length(psp)))"
"0","abs.bias.blogger.cor <- rep(0,length(length(psp)))"
"0","abs.bias.interpol.cor <- rep(0,length(length(psp)))"
"0","rel.bias.internet.cor <- rep(0,length(length(psp)))"
"0","rel.bias.blogger.cor <- rep(0,length(length(psp)))"
"0","rel.bias.interpol.cor <- rep(0,length(length(psp)))"
"0",""
"0",""
"0","abs.bias.internet.cor.rak <- rep(0,length(length(psp)))"
"0","abs.bias.blogger.cor.rak<- rep(0,length(length(psp)))"
"0","abs.bias.interpol.cor.rak <- rep(0,length(length(psp)))"
"0",""
"0","rel.bias.internet.cor.rak<- rep(0,length(length(psp)))"
"0","rel.bias.blogger.cor.rak<- rep(0,length(length(psp)))"
"0","rel.bias.interpol.cor.rak <- rep(0,length(length(psp)))"
"0",""
"0",""
"0",""
"0",""
"0","start_time <- Sys.time()"
"0",""
"0","for (i in 1:r) {"
"0","  #sample"
"0","  index_internet <- sample(1:nrow(subset_internet), c, replace = T)"
"0","  sample_internet <- subset_internet[index_internet,]"
"0","  index_blogger <- sample(1:nrow(subset_blogger), c, replace = T)"
"0","  sample_blogger <- subset_blogger[index_blogger,]"
"0","  index_interpol  <- sample(1:nrow(subset_interpol ), c, replace = T)"
"0","  sample_interpol <- subset_interpol[index_interpol,]"
"0","  "
"0",""
"0","  # nonprob bekommt Z=1 und reference survey Z=0"
"0","  "
"0","  Univ_18$Z <- rep(0, length(Univ_18[,1]))"
"0","  "
"0","  sample_blogger$Z <- rep(1, length(sample_blogger[,1]))"
"0","  sample_internet$Z <- rep(1, length(sample_internet[,1]))"
"0","  sample_interpol$Z <- rep(1, length(sample_interpol[,1]))"
"0","  "
"0","  #concatenate reference sample and nonprob sample"
"0","  joint_sample_blogger <- rbind(Univ_18,sample_blogger)"
"0","  joint_sample_internet <- rbind(Univ_18,sample_internet)"
"0","  joint_sample_interpol <- rbind(Univ_18,sample_interpol)"
"0","  "
"0","  "
"0","  # Invertierung Z Berechnet P(Z=0)"
"0","  "
"0","  joint_sample_blogger$Zinv <- ifelse(joint_sample_blogger$Z == 0,1,0)"
"0","  joint_sample_internet$Zinv <- ifelse(joint_sample_internet$Z == 0,1,0)"
"0","  joint_sample_interpol$Zinv <- ifelse(joint_sample_interpol$Z == 0,1,0)"
"0","  "
"0","  "
"0",""
"0",""
"0","  model_blogger= glm(as.formula(paste(""Zinv ~ "", paste(xnam))),data=joint_sample_blogger,"
"0","                     family=binomial())"
"0","  model_internet = glm(as.formula(paste(""Zinv ~ "", paste(xnam))), data=joint_sample_internet,"
"0","                       family=binomial())"
"0","  model_interpol = glm(as.formula(paste(""Zinv ~ "", paste(xnam))), data=joint_sample_interpol,"
"0","                       family=binomial())"
"0","  "
"0","  "
"0","  sample_blogger <- subset(joint_sample_blogger, Z==1)"
"0","  sample_internet <- subset(joint_sample_internet, Z==1)"
"0","  sample_interpol <- subset(joint_sample_interpol, Z==1)"
"0","  "
"0","  #Berechnung von P(Z=0)"
"0","  sample_blogger$P_Z <- predict(model_blogger,sample_blogger ,type = 'response')"
"0","  sample_internet$P_Z <- predict(model_internet,sample_internet ,type = 'response')"
"0","  sample_interpol$P_Z <- predict(model_interpol,sample_interpol ,type = 'response')"
"0","  "
"0",""
"0","  "
"0","  #Berechnung von P(Z=0)/(1-P(Z=0))"
"0","  sample_blogger$corr_final <- sample_blogger$P_Z/(1-sample_blogger$P_Z)"
"0","  sample_internet$corr_final <- sample_internet$P_Z/(1-sample_internet$P_Z)"
"0","  sample_interpol$corr_final <- sample_interpol$P_Z/(1-sample_interpol$P_Z)"
"0","  "
"0","  "
"0","  pseudoweights_blogger[i,] <- sample_blogger$corr_final"
"0","  pseudoweights_internet[i,] <- sample_internet$corr_final"
"0","  pseudoweights_interpol[i,] <- sample_interpol$corr_final"
"0","  "
"0","  # hist(sample_blogger$corr_final,  freq = F,ylim = c(0,0.008), xlim = c(0,1500))"
"0","  # lines(density(sample_blogger$corr_final, na.rm = T))"
"0","  "
"0","  # Correct estimates of Party Shares ----------------------------------------"
"0","  "
"0","  "
"0","  design.blogger.corr <- svydesign(~1,weights = ~corr_final,data = sample_blogger)"
"0","  design.internet.corr <- svydesign(~1,weights = ~corr_final,data = sample_internet)"
"0","  design.interpol.corr <- svydesign(~1,weights = ~corr_final,data = sample_interpol)"
"0","  "
"0","  internet.cor[i,] <- round(prop.table(svytable(~partei,design = design.internet.corr)),3)*100"
"0","  blogger.cor[i,] <- round(prop.table(svytable(~partei,design = design.blogger.corr)),3)*100"
"0","  interpol.cor[i,] <- round(prop.table(svytable(~partei,design = design.interpol.corr)),3) *100"
"0","  "
"0","  ####raking"
"0","  "
"0","  sample_internet$gewicht_2 <- sample_internet$gewicht*100"
"0","  sample_blogger$gewicht_2 <- sample_blogger$gewicht*100"
"0","  sample_interpol$gewicht_2 <- sample_interpol$gewicht*100"
"0","  "
"0","  "
"0","  wCal_internet <- calibration(sample_internet, marginMatrix=margins, colWeights=""gewicht_2"""
"0","                               , method=""raking"", description=F,maxIter=2500)"
"0","  wCal_blogger <- calibration(sample_blogger, marginMatrix=margins, colWeights=""gewicht_2"""
"0","                              , method=""raking"", description=F,maxIter=2500)"
"0","  wCal_interpol <- calibration(sample_interpol, marginMatrix=margins, colWeights=""gewicht_2"""
"0","                               , method=""raking"", description=F,maxIter=2500)"
"0","  "
"0","  calibrationweights_internet[i,] <- wCal_internet"
"0","  calibrationweights_blogger[i,] <- wCal_blogger"
"0","  calibrationweights_interpol[i,] <- wCal_interpol"
"0",""
"0","  design.internet.raking <- svydesign(~1,weights =wCal_internet, data = sample_internet )"
"0","  design.blogger.raking <- svydesign(~1,weights =wCal_blogger, data = sample_blogger)"
"0","  design.interpol.raking <- svydesign(~1,weights =wCal_interpol, data = sample_interpol)"
"0","  "
"0","  "
"0","  internet.rak[i,] <- round(prop.table(svytable(~partei,design = design.internet.raking)),3)*100"
"0","  blogger.rak[i,] <- round(prop.table(svytable(~partei,design = design.blogger.raking)),3)*100"
"0","  interpol.rak[i,] <- round(prop.table(svytable(~partei,design = design.interpol.raking)),3)*100"
"0","}"
"0","end_time <- Sys.time()"
"0","end_time-start_time"
"1","Time difference of "
"1",""
"1","3.670863"
"1",""
"1"," "
"1",""
"1","secs"
"1",""
"1","
"
